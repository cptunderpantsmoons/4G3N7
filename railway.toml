# Railway Configuration for 4G3N7 AI Desktop Agent
# Deploy with: railway up

[build]
builder = "NIXPACKS"

[deploy]
healthcheckPath = "/"
healthcheckTimeout = 300
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

[[services]]
name = "4g3n7-ui"
source = "."
path = "/packages/4g3n7-ui"

[services.variables]
NODE_ENV = "production"
PORT = "9992"

[services.build]
builder = "NIXPACKS"
buildCommand = "npm run build"

[services.deploy]
healthcheckPath = "/"
healthcheckTimeout = 300
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

# 4G3N7 Agent Service
[[services]]
name = "4g3n7-agent"
source = "."
path = "/packages/4g3n7-agent"

[services.variables]
NODE_ENV = "production"
PORT = "9991"
# Database will be auto-configured by Railway
# DATABASE_URL will be set automatically

# AI Provider Keys (set these in Railway dashboard)
# ANTHROPIC_API_KEY = ""
# OPENAI_API_KEY = ""
# OPENROUTER_API_KEY = ""
# GEMINI_API_KEY = ""

# Optional Configuration
# G3N7_DESKTOP_BASE_URL = "http://4g3n7-desktop:9990"
# OPENROUTER_API_BASE = "https://openrouter.ai/api/v1"
# FILE_STORAGE_PROVIDER = "local"
# AWS_ACCESS_KEY_ID = ""
# AWS_SECRET_ACCESS_KEY = ""
# AWS_REGION = "us-east-1"
# FILE_STORAGE_BUCKET = "4g3n7-files"

[services.build]
builder = "NIXPACKS"

[services.deploy]
healthcheckPath = "/health"
healthcheckTimeout = 300
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

# 4G3N7 Desktop Service
[[services]]
name = "4g3n7-desktop"
source = "."
path = "/packages/4g3n7d"

[services.variables]
NODE_ENV = "production"
PORT = "9990"

[services.build]
builder = "NIXPACKS"

[services.deploy]
healthcheckPath = "/health"
healthcheckTimeout = 300
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

# PostgreSQL Database
[[services]]
name = "postgres"
source = "."

[services.variables]
POSTGRES_USER = "postgres"
POSTGRES_PASSWORD = "postgres"
POSTGRES_DB = "4g3n7db"

[services.build]
builder = "NIXPACKS"
image = "postgres:16-alpine"

[services.deploy]
healthcheckPath = "/"
healthcheckTimeout = 300
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10